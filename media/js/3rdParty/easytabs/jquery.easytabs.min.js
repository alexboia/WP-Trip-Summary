!function($){$.easytabs=function(container,options){var plugin=this,$container=$(container),defaults={animate:!0,panelActiveClass:"active",tabActiveClass:"active",defaultTab:"li:first-child",animationSpeed:"normal",tabs:"> ul > li",updateHash:!0,cycle:!1,collapsible:!1,collapsedClass:"collapsed",collapsedByDefault:!0,uiTabs:!1,transitionIn:"fadeIn",transitionOut:"fadeOut",transitionInEasing:"swing",transitionOutEasing:"swing",transitionCollapse:"slideUp",transitionUncollapse:"slideDown",transitionCollapseEasing:"swing",transitionUncollapseEasing:"swing",containerClass:"",tabsClass:"",tabClass:"",panelClass:"",cache:!0,event:"click",panelContext:$container},$defaultTab,$defaultTabLink,transitions,lastHash,skipUpdateToHash,animationSpeeds={fast:200,normal:400,slow:600},settings;plugin.init=function(){plugin.settings=settings=$.extend({},defaults,options),settings.bind_str=settings.event+".easytabs",settings.uiTabs&&(settings.tabActiveClass="ui-tabs-selected",settings.containerClass="ui-tabs ui-widget ui-widget-content ui-corner-all",settings.tabsClass="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all",settings.tabClass="ui-state-default ui-corner-top",settings.panelClass="ui-tabs-panel ui-widget-content ui-corner-bottom"),settings.collapsible&&void 0!==options.defaultTab&&void 0===options.collpasedByDefault&&(settings.collapsedByDefault=!1),"string"==typeof settings.animationSpeed&&(settings.animationSpeed=animationSpeeds[settings.animationSpeed]),$("a.anchor").remove().prependTo("body"),$container.data("easytabs",{}),plugin.setTransitions(),plugin.getTabs(),addClasses(),setDefaultTab(),bindToTabClicks(),initHashChange(),initCycle(),$container.attr("data-easytabs",!0)},plugin.setTransitions=function(){transitions=settings.animate?{show:settings.transitionIn,hide:settings.transitionOut,speed:settings.animationSpeed,collapse:settings.transitionCollapse,uncollapse:settings.transitionUncollapse,halfSpeed:settings.animationSpeed/2}:{show:"show",hide:"hide",speed:0,collapse:"hide",uncollapse:"show",halfSpeed:0}},plugin.getTabs=function(){var $matchingPanel;plugin.tabs=$container.find(settings.tabs),plugin.panels=$(),plugin.tabs.each((function(){var $tab=$(this),$a=$tab.children("a"),targetId=$tab.children("a").data("target");$tab.data("easytabs",{}),null!=targetId?$tab.data("easytabs").ajax=$a.attr("href"):targetId=$a.attr("href"),targetId=targetId.match(/#([^\?]+)/)[1],($matchingPanel=settings.panelContext.find("#"+targetId)).length?($matchingPanel.data("easytabs",{position:$matchingPanel.css("position"),visibility:$matchingPanel.css("visibility")}),$matchingPanel.not(settings.panelActiveClass).hide(),plugin.panels=plugin.panels.add($matchingPanel),$tab.data("easytabs").panel=$matchingPanel):(plugin.tabs=plugin.tabs.not($tab),"console"in window&&console.warn("Warning: tab without matching panel for selector '#"+targetId+"' removed from set"))}))},plugin.selectTab=function($clicked,callback){var url,hash=window.location.hash.match(/^[^\?]*/)[0],$targetPanel=$clicked.parent().data("easytabs").panel,ajaxUrl=$clicked.parent().data("easytabs").ajax;settings.collapsible&&!skipUpdateToHash&&($clicked.hasClass(settings.tabActiveClass)||$clicked.hasClass(settings.collapsedClass))?plugin.toggleTabCollapse($clicked,$targetPanel,ajaxUrl,callback):$clicked.hasClass(settings.tabActiveClass)&&$targetPanel.hasClass(settings.panelActiveClass)&&settings.cache||activateTab($clicked,$targetPanel,ajaxUrl,callback)},plugin.toggleTabCollapse=function($clicked,$targetPanel,ajaxUrl,callback){plugin.panels.stop(!0,!0),fire($container,"easytabs:before",[$clicked,$targetPanel,settings])&&(plugin.tabs.filter("."+settings.tabActiveClass).removeClass(settings.tabActiveClass).children().removeClass(settings.tabActiveClass),$clicked.hasClass(settings.collapsedClass)?(!ajaxUrl||settings.cache&&$clicked.parent().data("easytabs").cached||($container.trigger("easytabs:ajax:beforeSend",[$clicked,$targetPanel]),$targetPanel.load(ajaxUrl,(function(response,status,xhr){$clicked.parent().data("easytabs").cached=!0,$container.trigger("easytabs:ajax:complete",[$clicked,$targetPanel,response,status,xhr])}))),$clicked.parent().removeClass(settings.collapsedClass).addClass(settings.tabActiveClass).children().removeClass(settings.collapsedClass).addClass(settings.tabActiveClass),$targetPanel.addClass(settings.panelActiveClass)[transitions.uncollapse](transitions.speed,settings.transitionUncollapseEasing,(function(){$container.trigger("easytabs:midTransition",[$clicked,$targetPanel,settings]),"function"==typeof callback&&callback()}))):($clicked.addClass(settings.collapsedClass).parent().addClass(settings.collapsedClass),$targetPanel.removeClass(settings.panelActiveClass)[transitions.collapse](transitions.speed,settings.transitionCollapseEasing,(function(){$container.trigger("easytabs:midTransition",[$clicked,$targetPanel,settings]),"function"==typeof callback&&callback()}))))},plugin.matchTab=function(hash){return plugin.tabs.find("[href='"+hash+"'],[data-target='"+hash+"']").first()},plugin.matchInPanel=function(hash){return hash&&plugin.validId(hash)?plugin.panels.filter(":has("+hash+")").first():[]},plugin.validId=function(id){return id.substr(1).match(/^[A-Za-z]+[A-Za-z0-9\-_:\.].$/)},plugin.selectTabFromHashChange=function(){var hash=window.location.hash.match(/^[^\?]*/)[0],$tab=plugin.matchTab(hash),$panel;settings.updateHash&&($tab.length?(skipUpdateToHash=!0,plugin.selectTab($tab)):($panel=plugin.matchInPanel(hash)).length?(hash="#"+$panel.attr("id"),$tab=plugin.matchTab(hash),skipUpdateToHash=!0,plugin.selectTab($tab)):$defaultTab.hasClass(settings.tabActiveClass)||settings.cycle||(""===hash||plugin.matchTab(lastHash).length||$container.closest(hash).length)&&(skipUpdateToHash=!0,plugin.selectTab($defaultTabLink)))},plugin.cycleTabs=function(tabNumber){settings.cycle&&(tabNumber%=plugin.tabs.length,$tab=$(plugin.tabs[tabNumber]).children("a").first(),skipUpdateToHash=!0,plugin.selectTab($tab,(function(){setTimeout((function(){plugin.cycleTabs(tabNumber+1)}),settings.cycle)})))},plugin.publicMethods={select:function(tabSelector){var $tab;0===($tab=plugin.tabs.filter(tabSelector)).length?0===($tab=plugin.tabs.find("a[href='"+tabSelector+"']")).length&&0===($tab=plugin.tabs.find("a"+tabSelector)).length&&0===($tab=plugin.tabs.find("[data-target='"+tabSelector+"']")).length&&0===($tab=plugin.tabs.find("a[href$='"+tabSelector+"']")).length&&$.error("Tab '"+tabSelector+"' does not exist in tab set"):$tab=$tab.children("a").first(),plugin.selectTab($tab)}};var fire=function(obj,name,data){var event=$.Event(name);return obj.trigger(event,data),!1!==event.result},addClasses=function(){$container.addClass(settings.containerClass),plugin.tabs.parent().addClass(settings.tabsClass),plugin.tabs.addClass(settings.tabClass),plugin.panels.addClass(settings.panelClass)},setDefaultTab=function(){var hash=window.location.hash.match(/^[^\?]*/)[0],$selectedTab=plugin.matchTab(hash).parent(),$panel;1===$selectedTab.length?($defaultTab=$selectedTab,settings.cycle=!1):($panel=plugin.matchInPanel(hash)).length?(hash="#"+$panel.attr("id"),$defaultTab=plugin.matchTab(hash).parent()):0===($defaultTab=plugin.tabs.parent().find(settings.defaultTab)).length&&$.error("The specified default tab ('"+settings.defaultTab+"') could not be found in the tab set ('"+settings.tabs+"') out of "+plugin.tabs.length+" tabs."),$defaultTabLink=$defaultTab.children("a").first(),activateDefaultTab($selectedTab)},activateDefaultTab=function($selectedTab){var defaultPanel,defaultAjaxUrl;settings.collapsible&&0===$selectedTab.length&&settings.collapsedByDefault?$defaultTab.addClass(settings.collapsedClass).children().addClass(settings.collapsedClass):(defaultPanel=$($defaultTab.data("easytabs").panel),!(defaultAjaxUrl=$defaultTab.data("easytabs").ajax)||settings.cache&&$defaultTab.data("easytabs").cached||($container.trigger("easytabs:ajax:beforeSend",[$defaultTabLink,defaultPanel]),defaultPanel.load(defaultAjaxUrl,(function(response,status,xhr){$defaultTab.data("easytabs").cached=!0,$container.trigger("easytabs:ajax:complete",[$defaultTabLink,defaultPanel,response,status,xhr])}))),$defaultTab.data("easytabs").panel.show().addClass(settings.panelActiveClass),$defaultTab.addClass(settings.tabActiveClass).children().addClass(settings.tabActiveClass)),$container.trigger("easytabs:initialised",[$defaultTabLink,defaultPanel])},bindToTabClicks=function(){plugin.tabs.children("a").bind(settings.bind_str,(function(e){settings.cycle=!1,skipUpdateToHash=!1,plugin.selectTab($(this)),e.preventDefault?e.preventDefault():e.returnValue=!1}))},activateTab=function($clicked,$targetPanel,ajaxUrl,callback){if(plugin.panels.stop(!0,!0),fire($container,"easytabs:before",[$clicked,$targetPanel,settings])){var $visiblePanel=plugin.panels.filter(":visible"),$panelContainer=$targetPanel.parent(),targetHeight,visibleHeight,heightDifference,showPanel,hash=window.location.hash.match(/^[^\?]*/)[0];settings.animate&&(targetHeight=getHeightForHidden($targetPanel),visibleHeight=$visiblePanel.length?setAndReturnHeight($visiblePanel):0,heightDifference=targetHeight-visibleHeight),lastHash=hash,showPanel=function(){$container.trigger("easytabs:midTransition",[$clicked,$targetPanel,settings]),settings.animate&&"fadeIn"==settings.transitionIn&&heightDifference<0&&$panelContainer.animate({height:$panelContainer.height()+heightDifference},transitions.halfSpeed).css({"min-height":""}),settings.updateHash&&!skipUpdateToHash?window.location.hash="#"+$targetPanel.attr("id"):skipUpdateToHash=!1,$targetPanel[transitions.show](transitions.speed,settings.transitionInEasing,(function(){$panelContainer.css({height:"","min-height":""}),$container.trigger("easytabs:after",[$clicked,$targetPanel,settings]),"function"==typeof callback&&callback()}))},!ajaxUrl||settings.cache&&$clicked.parent().data("easytabs").cached||($container.trigger("easytabs:ajax:beforeSend",[$clicked,$targetPanel]),$targetPanel.load(ajaxUrl,(function(response,status,xhr){$clicked.parent().data("easytabs").cached=!0,$container.trigger("easytabs:ajax:complete",[$clicked,$targetPanel,response,status,xhr])}))),settings.animate&&"fadeOut"==settings.transitionOut&&(heightDifference>0?$panelContainer.animate({height:$panelContainer.height()+heightDifference},transitions.halfSpeed):$panelContainer.css({"min-height":$panelContainer.height()})),plugin.tabs.filter("."+settings.tabActiveClass).removeClass(settings.tabActiveClass).children().removeClass(settings.tabActiveClass),plugin.tabs.filter("."+settings.collapsedClass).removeClass(settings.collapsedClass).children().removeClass(settings.collapsedClass),$clicked.parent().addClass(settings.tabActiveClass).children().addClass(settings.tabActiveClass),plugin.panels.filter("."+settings.panelActiveClass).removeClass(settings.panelActiveClass),$targetPanel.addClass(settings.panelActiveClass),$visiblePanel.length?$visiblePanel[transitions.hide](transitions.speed,settings.transitionOutEasing,showPanel):$targetPanel[transitions.uncollapse](transitions.speed,settings.transitionUncollapseEasing,showPanel)}},getHeightForHidden=function($targetPanel){if($targetPanel.data("easytabs")&&$targetPanel.data("easytabs").lastHeight)return $targetPanel.data("easytabs").lastHeight;var display=$targetPanel.css("display"),outerCloak,height;try{outerCloak=$("<div></div>",{position:"absolute",visibility:"hidden",overflow:"hidden"})}catch(e){outerCloak=$("<div></div>",{visibility:"hidden",overflow:"hidden"})}return height=$targetPanel.wrap(outerCloak).css({position:"relative",visibility:"hidden",display:"block"}).outerHeight(),$targetPanel.unwrap(),$targetPanel.css({position:$targetPanel.data("easytabs").position,visibility:$targetPanel.data("easytabs").visibility,display:display}),$targetPanel.data("easytabs").lastHeight=height,height},setAndReturnHeight=function($visiblePanel){var height=$visiblePanel.outerHeight();return $visiblePanel.data("easytabs")?$visiblePanel.data("easytabs").lastHeight=height:$visiblePanel.data("easytabs",{lastHeight:height}),height},initHashChange=function(){"function"==typeof $(window).hashchange?$(window).hashchange((function(){plugin.selectTabFromHashChange()})):$.address&&"function"==typeof $.address.change&&$.address.change((function(){plugin.selectTabFromHashChange()}))},initCycle=function(){var tabNumber;settings.cycle&&(tabNumber=plugin.tabs.index($defaultTab),setTimeout((function(){plugin.cycleTabs(tabNumber+1)}),settings.cycle))};plugin.init()},$.fn.easytabs=function(options){var args=arguments;return this.each((function(){var $this=$(this),plugin=$this.data("easytabs");if(void 0===plugin&&(plugin=new $.easytabs(this,options),$this.data("easytabs",plugin)),plugin.publicMethods[options])return plugin.publicMethods[options].apply(plugin.publicMethods,Array.prototype.slice.call(args,1))}))}}(jQuery);